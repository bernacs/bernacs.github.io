function draw(){function j(){c=$(window).width(),d=$(window).height(),g.attr("width",c).attr("height",d).attr("viewBox","0 0 "+c+" "+d),f.size([c,d]).resume()}function k(){var c=m(e),d=d3.layout.tree().links(c);f.nodes(c).links(d).linkDistance(function(a){return a.source.linkLength?a.source.linkLength:140}).linkStrength(function(a){return a.source.linkStrength?a.source.linkStrength:1}).start(),h=h.data(d,function(a){return a.target.id}),h.exit().remove(),h.enter().insert("line",".node").attr("class","link").style("stroke-width",function(a){return 1.2*a.target.linkWeight+"px"}),i=i.data(c,function(a){return a.id}),i.exit().remove();var g=i.enter().append("g").attr("class","node").call(f.drag);g.append("a").attr("target","_self").attr("xlink:href",function(a){return a.link}).append("image").attr("class","thumb").attr("x",b).attr("y",b).attr("width",a).attr("height",a).attr("xlink:href",function(a){return a.img?a.img:"http://ima.gs/transparent/150x150.png"}),g.append("text").attr("class","caption").attr("text-anchor","middle").attr("dy",function(a){return a.offset?-b+20-a.offset:-b+20}).text(function(a){return a.name})}function l(){h.attr("x1",function(a){return a.source.x}).attr("y1",function(a){return a.source.y}).attr("x2",function(a){return a.target.x}).attr("y2",function(a){return a.target.y}),i.attr("transform",function(a){return"translate("+a.x+","+a.y+")"})}function m(a){function d(a){a.children&&a.children.forEach(d),a.id||(a.id=++c),b.push(a)}var b=[],c=0;return d(a),b}var e,a=160,b=-(a/2),c=$(window).width(),d=$(window).height(),f=d3.layout.force().charge(-500).gravity(.02).on("tick",l),g=d3.select("#graph").append("svg"),h=g.selectAll(".link"),i=g.selectAll(".node");j(),d3.json("/assets/json/graph.json",function(a,b){a&&console.log("json error",b),e=b,k()}),d3.select(window).on("resize",j)}d3.select(window).on("load",draw);