const svg=d3.select("#graph");function getWindowSize(){const t=window,e=document,n=e.documentElement,i=e.getElementsByTagName("body")[0];return{width:t.innerWidth||n.clientWidth||i.clientWidth,height:t.innerHeight||n.clientHeight||i.clientHeight}}function updateGraphSize(){const t=getWindowSize();svg.attr("width",t.width).attr("height",t.height).attr("viewBox","0 0 "+t.width+" "+t.height)}updateGraphSize(),window.onresize=updateGraphSize;const constants={bounds:{radius:20,active:1},link:{distance:100,strength:.5},physics:{charge_strength:-50,collision_radius:20},opacity:{full:.9,dimmed:.5},alpha:{base:.5,min:.01,decay:.001},styles:{wider:{width:200,height:80,rx:10,ry:10},wide:{width:150,height:80,rx:10,ry:10},large:{width:120,height:80,rx:10,ry:10},medium:{width:115,height:70,rx:10,ry:10},small:{width:90,height:50,rx:10,ry:10},tiny:{width:70,height:25,rx:10,ry:10},node:{width:10,height:10,rx:10,ry:10}}};d3.json("assets/data/phd.json").then(t=>{const e=d3.forceSimulation(t.nodes).alpha(constants.alpha.base).alphaMin(constants.alpha.min).alphaDecay(constants.alpha.decay).force("charge",d3.forceManyBody().strength(constants.physics.charge_strength)).force("center",d3.forceCenter(getWindowSize().width/2,getWindowSize().height/2)).force("link",d3.forceLink(t.links).id(t=>t.id).distance(constants.link.distance).strength(constants.link.strength)).force("collision",d3.forceCollide().radius(constants.physics.collision_radius)).on("tick",function(){r.call(l),s.call(h)}),n=new Map,i=(t,e)=>t==e||n[t+" > "+e];t.links.forEach(t=>{n[t.source.index+" > "+t.target.index]=!0,n[t.target.index+" > "+t.source.index]=!0});const a=svg.append("g").attr("class","m-g"),s=a.append("g").attr("class","l-g").selectAll("line").data(t.links).enter().append("line").attr("stroke-width",t=>1+t.group+d3.randomUniform(0,2)()),r=a.append("g").attr("class","n-g").selectAll("g").data(t.nodes).enter().append("g").attr("class","n-e"),o=(t,e)=>null!=constants.styles[t]?constants.styles[t][e]:constants.styles.small[e];function d(t){return isFinite(t)?t:0}function c(t,e,n){return constants.bounds.active?{x:d(Math.max(constants.bounds.radius,Math.min(e-constants.bounds.radius,t.x))),y:d(Math.max(constants.bounds.radius,Math.min(n-constants.bounds.radius,t.y)))}:{x:d(t.x),y:d(t.y)}}function h(t){const{width:e,height:n}=getWindowSize();t.attr("x1",t=>c(t.source,e,n).x).attr("y1",t=>c(t.source,e,n).y).attr("x2",t=>c(t.target,e,n).x).attr("y2",t=>c(t.target,e,n).y)}function l(t){const{width:e,height:n}=getWindowSize();t.attr("transform",t=>{const i=c(t,e,n);return"translate("+i.x+","+i.y+")"})}r.append("rect").attr("width",t=>o(t.size,"width")).attr("height",t=>o(t.size,"height")).attr("x",t=>-Math.floor(o(t.size,"width")/2)).attr("y",t=>-Math.floor(o(t.size,"height")/2)).attr("rx",t=>o(t.size,"rx")).attr("ry",t=>o(t.size,"ry")).attr("class",t=>t.class),r.filter(t=>"image"!=t.class).append("foreignObject").attr("width",t=>o(t.size,"width")).attr("height",t=>o(t.size,"height")).attr("x",t=>-Math.floor(o(t.size,"width")/2)).attr("y",t=>-Math.floor(o(t.size,"height")/2)).append("xhtml:div").attr("class","clabel").append("xhtml:p").attr("class","label").text((t,e)=>t.text),r.filter(t=>"image"==t.class).append("image").attr("xlink:href",t=>t.file).attr("width",t=>o(t.size,"width")).attr("height",t=>o(t.size,"height")).attr("x",t=>-Math.floor(o(t.size,"width")/2)).attr("y",t=>-Math.floor(o(t.size,"height")/2)),r.on("mouseover",function(t){const e=d3.select(d3.event.target).datum().index;r.style("opacity",t=>i(e,t.index)?constants.opacity.full:constants.opacity.dimmed),s.style("opacity",t=>t.source.index==e||t.target.index==e?constants.opacity.full:constants.opacity.dimmed)}).on("mouseout",function(){r.style("opacity",constants.opacity.full),s.style("opacity",constants.opacity.full)}),r.call(d3.drag().on("start",function(t){d3.event.sourceEvent.stopPropagation(),d3.event.active||e.alphaTarget(.3).restart();t.fx=t.x,t.fy=t.y}).on("drag",function(t){t.fx=d3.event.x,t.fy=d3.event.y}).on("end",function(t){d3.event.active||e.alphaTarget(0);t.fx=null,t.fy=null}))});